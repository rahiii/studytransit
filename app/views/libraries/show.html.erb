<% content_for :title, @library.name %>

<% if notice %>
  <div class="notice"><%= notice %></div>
<% end %>

<% if alert %>
  <div class="alert"><%= alert %></div>
<% end %>

<header class="detail-header">
  <%= link_to libraries_path, class: "back-arrow" do %>
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
  <% end %>
  <div class="header-title-section">
    <h1 class="library-title"><%= @library.name.upcase %></h1>
    <% if @library.location.present? %>
      <div class="library-location-header">
        <%= @library.location %>
      </div>
    <% end %>
  </div>
</header>

<main class="spaces-container">
  <% @library.spaces.each do |space| %>
    <% form_space = defined?(@space) && @space.id == space.id ? @space : space %>
    <section class="space-section">
      <div class="space-card">
        <div class="space-header">
          <div class="space-name"><%= space.name %></div>
          <% avg_rating = space.average_rating_last_hour %>
          <% using_last_week = space.using_last_week_rating? %>
          <% last_rating_time = space.last_rating_timestamp_recent || space.last_rating_timestamp %>
          <% if avg_rating %>
            <div class="rating-badge <%= 'last-week-rating' if using_last_week %>">
              <span class="rating-label">
                <%= using_last_week ? "Avg (last week):" : "Avg (1hr):" %>
              </span>
              <span class="rating-value"><%= avg_rating %>/5</span>
            </div>
          <% else %>
            <div class="rating-badge no-rating">
              <span class="rating-label">No recent ratings</span>
            </div>
          <% end %>
        </div>
        <div class="occupancy-indicators">
          <% emoji_count = avg_rating ? avg_rating.round : 0 %>
          <% emoji_count.times do %>
            <span class="person-icon">ðŸ‘¤</span>
          <% end %>
        </div>
        <% if last_rating_time %>
          <div class="rating-timestamp">
            Updated <%= time_ago_in_words(last_rating_time) %> ago
          </div>
        <% end %>
      </div>
      
      <div class="capacity-section">
        <h3 class="capacity-title">Add Capacity</h3>
        <% if form_space.errors[:capacity].any? %>
          <div class="alert capacity-error"><%= form_space.errors[:capacity].to_sentence %></div>
        <% end %>
        <%= form_with model: [@library, form_space], class: "capacity-form" do |form| %>
          <%= form.number_field :capacity, min: 1, max: 5, placeholder: "Enter capacity (1-5)", class: "capacity-input" %>
          <%= form.submit "Update Capacity", class: "capacity-submit" %>
        <% end %>
      </div>
    </section>
  <% end %>
</main>

<%= render "shared/footer" %>
